#include "main.h"

void SystemClock_Config(void);

/**
  * @brief  The application entry point.
  * @retval int
  */
int main(void)
{
  HAL_Init();

  SystemClock_Config();
  trigger_init();

  xmss_params params;
  xmss_parse_oid(&params, 0xd);

  unsigned char pub_seed[params.n];
  unsigned char pk1[1224] = "\xA9\xE6\x8B\xAE\x2A\xB5\x44\xA9\x64\x21\xBA\x15\x27\x82\xC2\x30\xE0\x93\x6C\x19\x36\xC8\x66\x8F\xDE\xF4\xC4\xD1\x9F\x80\xA1\xCC\xA6\xF5\x2D\xF2\x97\x49\xA2\x48\xF4\xC7\x3A\x50\xC8\xFF\x9E\xF9\xA4\x63\xCA\x94\x67\x55\xD6\x3B\xE5\x33\xDF\xE6\xCC\xCB\xEC\xAC\x2C\xCE\x9F\xEB\x3B\x31\x53\x64\x99\xF1\xAA\x7D\xAE\x1E\x69\x12\xBB\xB0\x65\x52\x8E\xD9\x4A\x3F\x93\x8B\x95\x42\x4C\x28\x13\xBD\x7F\x38\x8A\x40\x23\xBC\x54\x21\xA2\x2D\x9D\x7B\x33\xD4\x03\x7F\x73\xEF\x13\x9B\x0D\xDD\x91\x8C\x80\xFC\x1B\x41\xD7\x2B\xFE\x36\x6A\xAD\x83\x4E\x67\x92\xB6\x47\x1F\xAE\xF7\x6C\xAC\xD3\x20\x4E\x08\x60\xC4\x0F\x36\xB7\x01\x2D\x48\xF2\xED\xD3\x95\x59\xA1\x7A\x29\xBC\xEC\x23\xBB\x78\x82\x3A\xDF\xFC\x09\x2B\xA7\xF5\xAB\x50\x7D\x67\xD8\x44\xA1\x89\x24\x91\xE4\x87\xB8\x19\xC5\xA1\x74\x71\x77\x04\x4E\x10\x1F\xF2\xC4\xE7\x09\x0D\xB0\x26\x47\xFD\xC1\xD8\x66\xFE\xBE\xDF\x4C\xD3\xFF\x5A\xC4\x81\x36\x1F\x62\x1D\x8F\x18\x32\x52\x96\xB6\x01\xB3\x4E\xE9\xAB\x31\xE6\xC7\xDD\xA3\xA1\x5B\x71\x83\xEF\xAB\x85\xA0\xE9\xCD\x36\x56\x03\xF5\xE4\xA5\x3A\x00\xAC\x5C\x97\x82\x7F\x4E\xFD\xAC\xEA\x4C\xFA\x41\x84\x40\x7F\x9E\x5D\xF0\x6C\x80\x9E\xC2\xDD\xA2\xBF\x23\xA6\x36\xB4\xE2\xD1\xBE\x66\x8E\x7C\xA0\x5B\x88\x6E\xC1\xDB\x95\xF3\x3E\x00\x3D\x19\x57\x6B\x9C\x1F\xBF\xA6\x4C\xF4\xB1\x3C\x9C\x69\x39\xA6\xDA\x65\xC0\x0D\x46\xAF\x71\x7A\xCC\xCD\xFD\x0F\x3D\xD2\x91\xBA\x61\xBF\xE0\xB7\x60\x5C\x79\x3F\xEC\x2F\x72\xE5\x87\x18\xB5\xED\x5D\x1E\xF9\x8E\x9A\x14\x63\x9E\x62\xF7\x40\x7D\x7B\xD0\xE0\xBB\xB6\xC6\x60\xCE\xAC\xFF\x2B\x05\xE8\xA0\x92\x4A\x26\xE8\x55\x70\x9F\x84\x1D\x6B\x92\x67\x0A\xE0\x5D\xFD\x9A\x36\x12\xE4\x12\x4B\x32\x8A\x00\x0A\x5B\x92\x17\x03\x48\xA1\x0E\xDC\x93\x47\x15\x80\x3E\xDA\xA9\x23\x03\xD0\x88\x8F\xD7\xCE\x93\x0E\x0A\x1A\xA1\xEA\xD2\xC6\x91\x41\x04\xFA\x91\x7B\xF2\x34\xC0\x6D\x1E\x69\xCA\xB7\x6C\x0D\x52\x18\x75\x2A\x44\xE6\x59\xF4\x8B\x0C\xAB\x30\xDC\xDA\x0E\x5B\x8F\xBB\x91\x1D\x81\x3D\x18\x42\x3A\xF3\x77\xBB\x7F\x8D\x9F\xFA\xB8\x38\x78\x9E\x22\xAC\x00\x8E\xFF\x43\x7B\xEF\xE4\xDC\x46\xAC\x1A\xFE\x66\x67\x5B\xAB\x93\xC1\x1C\x58\x55\xA5\x99\x85\xE1\x62\xF0\xFC\xEE\xFE\xAA\xDE\x4E\x9A\xB8\x6D\x04\xA0\x0B\x81\xCA\x22\xF5\xA8\x01\x2E\x42\xCD\x3B\x56\xBC\x6A\x9B\xBE\xE0\xA7\x9C\x1F\x93\xF2\xEA\x6F\x1B\x0D\xBC\xB7\x25\x31\x10\x13\x99\x21\x85\x2F\x40\x23\x98\x2D\x75\x5B\x6D\xA6\x9F\x8A\x69\x6F\x68\xEC\xA6\x03\x47\x4D\xCD\xD6\x0A\xB7\x0C\xEA\x28\x67\x3A\xF2\x98\x23\xFC\x72\xCF\x36\xB2\x3A\x7D\xE1\x23\xE7\x7D\x0A\x84\x0B\xAB\x34\x66\xDF\xCF\x7B\x70\x78\xC7\x6A\xC2\x27\x70\x1D\x92\x7A\x42\xD8\x23\x44\xA2\x77\x6D\x23\x7F\x9A\x23\x88\xE7\xFD\x1B\x8E\x41\xEC\x32\x36\x7B\x72\xE1\x74\x13\x02\x27\xE1\xE7\x59\x57\xA7\xC3\xF9\x1C\xF7\xE3\x8B\x0B\x5F\xA0\x2C\xBE\x67\x47\x44\xD5\x85\x1C\x0C\x57\x3E\xDC\xC1\x72\x6A\xBD\xE0\x89\x4C\x50\x8F\xE3\x5B\x24\x36\xBD\xF5\xD5\xCF\x50\xBB\x49\x15\x7C\x01\x00\xE4\x17\xFB\x31\x0F\x9C\xE4\x78\x03\x4E\xDA\x38\x60\xAE\x00\x71\x90\x79\xD4\xDC\x1C\x6C\x1E\xF6\x60\x3E\x10\x8B\x5D\x8C\x88\xFD\x5D\x8E\x94\x20\xC8\xE9\xBC\x9A\x15\xC2\x46\x11\x3F\xC7\x51\x87\x0D\x94\x03\x7A\xC4\x80\xF6\x7A\x58\xBF\x22\x70\x89\xCC\x76\x6A\x24\x09\x2D\xA9\x84\xEF\xAB\xA7\x9C\xDC\x29\x7D\x2B\xE8\x7B\xD6\xDF\xF3\x17\x00\x29\xEC\x3E\x52\xE6\x06\xD1\x1E\xC9\xD3\xEE\xD6\x51\x69\x85\xC4\x39\xA2\xFB\xD7\xF8\xD6\x2A\x28\x64\xC1\x59\xA0\x16\x12\x27\x46\x6A\x0D\x54\xA8\xFB\x3E\x5E\xDB\x4B\x28\xDD\x9D\x10\x7F\x6E\xEB\x9A\x17\x69\xC4\xB4\xF0\x40\x0A\x50\x03\x41\x7A\xCB\xEC\x1D\x10\x53\x28\x97\x77\x00\xA0\xF0\x07\x89\x43\x83\x9B\xBB\x1F\xAA\x8F\xEB\x81\xE9\x22\xC6\xFC\x8C\x63\x57\x02\x49\x72\xAB\x3A\x6E\x76\x01\x95\x79\xDC\x86\xB7\xE7\x37\x4B\x39\x89\x63\x70\x92\xE8\x02\x23\x54\x11\x36\x1A\x06\xC1\xAC\x6D\xC6\x67\xC3\x6C\x41\x19\xEA\x9C\x81\xD1\x57\xDD\xB8\x54\x09\x6E\x65\x91\x2A\x0F\x0F\x5D\x0B\x6F\xF7\x9C\x14\x1F\x93\xB9\x0D\x25\xAA\x41\xBF\x41\x70\xF9\x9D\x3E\xAE\x05\x89\x61\xC0\x02\x4B\x1C\x92\x5A\x61\xFB\xB0\x72\x7E\x79\x3E\xB5\x04\x24\xC4\x6A\x06\x04\xC3\x79\xB5\xAD\xC9\x27\xCB\xBE\xD3\x83\x15\xBC\xF8\x40\xAF\xFB\x2E\xB5\x0B\x3E\xE9\xC5\xC0\x67\x26\x5F\xD3\x61\x58\xE1\x65\x60\x90\x18\xB8\x3E\xC9\x65\xAA\x32\x64\x9B\x58\xAE\x07\xEF\xEA\x51\xBE\xEC\x43\x90\xB2\x33\xF5\xA4\xE7\x4C\x4F\x80\x87\x36\x5D\x51\x45\xBE\x2D\x77\x77\xAC\xB9\xE3\xD6\x78\x92\x7D\xDD\x09\x69\xA2\xF0\x29\xE1\x89\xDF\x36\x01\xA8\x2A\x96\x14\x51\x9C\x4A\xAF\x3E\x94\xF0\x71\xF2\x76\x64\x8E\x54\xFC\x58\xFF\x48\x39\xE5\x36\x36\x7B\x0E\x5E\xDC\x4F\x7E\xED\x5D\x96\xA7\x1D\x52\xA9\xA9\xFE\x96\x7B\xD7\xFA\x5B\x5C\x8C\x21\x6E\x12\xCC\x25\x20\x7B\x62\xE8\x5E\x24\x01\xEA\x09\x7B\x28\x3F\x29\xE3\xFD\x49\xED\x1A\x38\x8E\x88\xDD\x2A\x6A\x92\x9F\x93\x14\x92\x79\xAF\x91\xF2\x1C\xDA\x8F\x6E\x0D\xBF\xB0\xDC\x71\x8B\x70\x63\x36\x60\xC9\x8B\x83\x58\x30\xAE\xB7\x90\x90\x31\x8A\x96\x0C\xA6\xB4\x84\x02\x2F\xD5\xC5\x5E\xA4\xFD\xFA\x37\x63\x27\xDC\xE8\x15\x1C\x5D\x00\xD8\x35\xB9\x70\xB4\xE4\x78\xF4\x6C\x23\x9B\x78\xEE\xC5\xE0\xCD\xEB\xB4\xC5\xD7\xF0\xFC\x5F\x10\xAD\x9C\xFB\xDD\x9F\x02\x49\xFB\x57\xF1\xE3\x5F\x66\x50\xE5\x44";
  unsigned char pk2[params.wots_sig_bytes];
  unsigned char sig[1224] = "\xA9\xE6\x8B\xAE\x2A\xB5\x44\xA9\x64\x21\xBA\x15\x27\x82\xC2\x30\xE0\x93\x6C\x19\x36\xC8\x66\x8F\xDE\xF4\xC4\xD1\x9F\x80\xA1\xCC\xA6\xF5\x2D\xF2\x97\x49\xA2\x48\xF4\xC7\x3A\x50\xC8\xFF\x9E\xF9\xA4\x63\xCA\x94\x67\x55\xD6\x3B\xE5\x33\xDF\xE6\xCC\xCB\xEC\xAC\x2C\xCE\x9F\xEB\x3B\x31\x53\x64\x99\xF1\xAA\x7D\xAE\x1E\x69\x12\xBB\xB0\x65\x52\x8E\xD9\x4A\x3F\x93\x8B\x95\x42\x4C\x28\x13\xBD\x7F\x38\x8A\x40\x23\xBC\x54\x21\xA2\x2D\x9D\x7B\x33\xD4\x03\x7F\x73\xEF\x13\x9B\x0D\xDD\x91\x8C\x80\xFC\x1B\x41\xD7\x2B\xFE\x36\x6A\xAD\x83\x4E\x67\x92\xB6\x47\x1F\xAE\xF7\x6C\xAC\xD3\x20\x4E\x08\x60\xC4\x0F\x36\xB7\x01\x2D\x48\xF2\xED\xD3\x95\x59\xA1\x7A\x29\xBC\xEC\x23\xBB\x78\x82\x3A\xDF\xFC\x09\x2B\xA7\xF5\xAB\x50\x7D\x67\xD8\x44\xA1\x89\x24\x91\xE4\x87\xB8\x19\xC5\xA1\x74\x71\x77\x04\x4E\x10\x1F\xF2\xC4\xE7\x09\x0D\xB0\x26\x47\xFD\xC1\xD8\x66\xFE\xBE\xDF\x4C\xD3\xFF\x5A\xC4\x81\x36\x1F\x62\x1D\x8F\x18\x32\x52\x96\xB6\x01\xB3\x4E\xE9\xAB\x31\xE6\xC7\xDD\xA3\xA1\x5B\x71\x83\xEF\xAB\x85\xA0\xE9\xCD\x36\x56\x03\xF5\xE4\xA5\x3A\x00\xAC\x5C\x97\x82\x7F\x4E\xFD\xAC\xEA\x4C\xFA\x41\x84\x40\x7F\x9E\x5D\xF0\x6C\x80\x9E\xC2\xDD\xA2\xBF\x23\xA6\x36\xB4\xE2\xD1\xBE\x66\x8E\x7C\xA0\x5B\x88\x6E\xC1\xDB\x95\xF3\x3E\x00\x3D\x19\x57\x6B\x9C\x1F\xBF\xA6\x4C\xF4\xB1\x3C\x9C\x69\x39\xA6\xDA\x65\xC0\x0D\x46\xAF\x71\x7A\xCC\xCD\xFD\x0F\x3D\xD2\x91\xBA\x61\xBF\xE0\xB7\x60\x5C\x79\x3F\xEC\x2F\x72\xE5\x87\x18\xB5\xED\x5D\x1E\xF9\x8E\x9A\x14\x63\x9E\x62\xF7\x40\x7D\x7B\xD0\xE0\xBB\xB6\xC6\x60\xCE\xAC\xFF\x2B\x05\xE8\xA0\x92\x4A\x26\xE8\x55\x70\x9F\x84\x1D\x6B\x92\x67\x0A\xE0\x5D\xFD\x9A\x36\x12\xE4\x12\x4B\x32\x8A\x00\x0A\x5B\x92\x17\x03\x48\xA1\x0E\xDC\x93\x47\x15\x80\x3E\xDA\xA9\x23\x03\xD0\x88\x8F\xD7\xCE\x93\x0E\x0A\x1A\xA1\xEA\xD2\xC6\x91\x41\x04\xFA\x91\x7B\xF2\x34\xC0\x6D\x1E\x69\xCA\xB7\x6C\x0D\x52\x18\x75\x2A\x44\xE6\x59\xF4\x8B\x0C\xAB\x30\xDC\xDA\x0E\x5B\x8F\xBB\x91\x1D\x81\x3D\x18\x42\x3A\xF3\x77\xBB\x7F\x8D\x9F\xFA\xB8\x38\x78\x9E\x22\xAC\x00\x8E\xFF\x43\x7B\xEF\xE4\xDC\x46\xAC\x1A\xFE\x66\x67\x5B\xAB\x93\xC1\x1C\x58\x55\xA5\x99\x85\xE1\x62\xF0\xFC\xEE\xFE\xAA\xDE\x4E\x9A\xB8\x6D\x04\xA0\x0B\x81\xCA\x22\xF5\xA8\x01\x2E\x42\xCD\x3B\x56\xBC\x6A\x9B\xBE\xE0\xA7\x9C\x1F\x93\xF2\xEA\x6F\x1B\x0D\xBC\xB7\x25\x31\x10\x13\x99\x21\x85\x2F\x40\x23\x98\x2D\x75\x5B\x6D\xA6\x9F\x8A\x69\x6F\x68\xEC\xA6\x03\x47\x4D\xCD\xD6\x0A\xB7\x0C\xEA\x28\x67\x3A\xF2\x98\x23\xFC\x72\xCF\x36\xB2\x3A\x7D\xE1\x23\xE7\x7D\x0A\x84\x0B\xAB\x34\x66\xDF\xCF\x7B\x70\x78\xC7\x6A\xC2\x27\x70\x1D\x92\x7A\x42\xD8\x23\x44\xA2\x77\x6D\x23\x7F\x9A\x23\x88\xE7\xFD\x1B\x8E\x41\xEC\x32\x36\x7B\x72\xE1\x74\x13\x02\x27\xE1\xE7\x59\x57\xA7\xC3\xF9\x1C\xF7\xE3\x8B\x0B\x5F\xA0\x2C\xBE\x67\x47\x44\xD5\x85\x1C\x0C\x57\x3E\xDC\xC1\x72\x6A\xBD\xE0\x89\x4C\x50\x8F\xE3\x5B\x24\x36\xBD\xF5\xD5\xCF\x50\xBB\x49\x15\x7C\x01\x00\xE4\x17\xFB\x31\x0F\x9C\xE4\x78\x03\x4E\xDA\x38\x60\xAE\x00\x71\x90\x79\xD4\xDC\x1C\x6C\x1E\xF6\x60\x3E\x10\x8B\x5D\x8C\x88\xFD\x5D\x8E\x94\x20\xC8\xE9\xBC\x9A\x15\xC2\x46\x11\x3F\xC7\x51\x87\x0D\x94\x03\x7A\xC4\x80\xF6\x7A\x58\xBF\x22\x70\x89\xCC\x76\x6A\x24\x09\x2D\xA9\x84\xEF\xAB\xA7\x9C\xDC\x29\x7D\x2B\xE8\x7B\xD6\xDF\xF3\x17\x00\x29\xEC\x3E\x52\xE6\x06\xD1\x1E\xC9\xD3\xEE\xD6\x51\x69\x85\xC4\x39\xA2\xFB\xD7\xF8\xD6\x2A\x28\x64\xC1\x59\xA0\x16\x12\x27\x46\x6A\x0D\x54\xA8\xFB\x3E\x5E\xDB\x4B\x28\xDD\x9D\x10\x7F\x6E\xEB\x9A\x17\x69\xC4\xB4\xF0\x40\x0A\x50\x03\x41\x7A\xCB\xEC\x1D\x10\x53\x28\x97\x77\x00\xA0\xF0\x07\x89\x43\x83\x9B\xBB\x1F\xAA\x8F\xEB\x81\xE9\x22\xC6\xFC\x8C\x63\x57\x02\x49\x72\xAB\x3A\x6E\x76\x01\x95\x79\xDC\x86\xB7\xE7\x37\x4B\x39\x89\x63\x70\x92\xE8\x02\x23\x54\x11\x36\x1A\x06\xC1\xAC\x6D\xC6\x67\xC3\x6C\x41\x19\xEA\x9C\x81\xD1\x57\xDD\xB8\x54\x09\x6E\x65\x91\x2A\x0F\x0F\x5D\x0B\x6F\xF7\x9C\x14\x1F\x93\xB9\x0D\x25\xAA\x41\xBF\x41\x70\xF9\x9D\x3E\xAE\x05\x89\x61\xC0\x02\x4B\x1C\x92\x5A\x61\xFB\xB0\x72\x7E\x79\x3E\xB5\x04\x24\xC4\x6A\x06\x04\xC3\x79\xB5\xAD\xC9\x27\xCB\xBE\xD3\x83\x15\xBC\xF8\x40\xAF\xFB\x2E\xB5\x0B\x3E\xE9\xC5\xC0\x67\x26\x5F\xD3\x61\x58\xE1\x65\x60\x90\x18\xB8\x3E\xC9\x65\xAA\x32\x64\x9B\x58\xAE\x07\xEF\xEA\x51\xBE\xEC\x43\x90\xB2\x33\xF5\xA4\xE7\x4C\x4F\x80\x87\x36\x5D\x51\x45\xBE\x2D\x77\x77\xAC\xB9\xE3\xD6\x78\x92\x7D\xDD\x09\x69\xA2\xF0\x29\xE1\x89\xDF\x36\x01\xA8\x2A\x96\x14\x51\x9C\x4A\xAF\x3E\x94\xF0\x71\xF2\x76\x64\x8E\x54\xFC\x58\xFF\x48\x39\xE5\x36\x36\x7B\x0E\x5E\xDC\x4F\x7E\xED\x5D\x96\xA7\x1D\x52\xA9\xA9\xFE\x96\x7B\xD7\xFA\x5B\x5C\x8C\x21\x6E\x12\xCC\x25\x20\x7B\x62\xE8\x5E\x24\x01\xEA\x09\x7B\x28\x3F\x29\xE3\xFD\x49\xED\x1A\x38\x8E\x88\xDD\x2A\x6A\x92\x9F\x93\x14\x92\x79\xAF\x91\xF2\x1C\xDA\x8F\x6E\x0D\xBF\xB0\xDC\x71\x8B\x70\x63\x36\x60\xC9\x16\x7F\x5B\x2C\xB9\x7A\x9A\x03\x69\xF3\x11\x71\xE1\xBB\x78\xBA\xE9\xC6\x31\xBE\xC1\x50\xE7\x68\xA1\xBD\x0A\xA5\x9A\x94\x7B\xD2\xED\xAF\xCA\x7A\xD2\x34\xB8\x79\xE0\xC1\xB6\xC3\x00\x1C\x21\xCF\xEB\xB4\xC5\xD7\xF0\xFC\x5F\x10\xAD\x9C\xFB\xDD\x9F\x02\x49\xFB\x57\xF1\xE3\x5F\x66\x50\xE5\x44";
  unsigned char m[params.n];
  uint32_t addr[8] = {0};
  
  memset(addr, '\0', 8 * sizeof(uint32_t));
  memset(pub_seed, '\0', params.n);
  memset(m, '\xff', params.n);
  
  wots_pk_from_sig(&params, pk2, sig, m, pub_seed, addr);

  if (!memcmp(pk1, pk2, params.wots_sig_bytes)) {
	  tio3_set(1);
  } else {
	  tio2_set(1);
  }

  trigger_set(0);

  while (1)
  {
  }
}

/**
  * @brief System Clock Configuration
  * @retval None
  */
void SystemClock_Config(void)
{
     RCC_OscInitTypeDef RCC_OscInitStruct;
     RCC_OscInitStruct.OscillatorType = RCC_OSCILLATORTYPE_HSE | RCC_OSCILLATORTYPE_HSI;
     RCC_OscInitStruct.HSEState       = RCC_HSE_BYPASS;
     RCC_OscInitStruct.HSIState       = RCC_HSI_OFF;
     RCC_OscInitStruct.PLL.PLLSource  = RCC_PLL_NONE;
     HAL_RCC_OscConfig(&RCC_OscInitStruct);

     RCC_ClkInitTypeDef RCC_ClkInitStruct;
     RCC_ClkInitStruct.ClockType      = (RCC_CLOCKTYPE_SYSCLK | RCC_CLOCKTYPE_HCLK | RCC_CLOCKTYPE_PCLK1 | RCC_CLOCKTYPE_PCLK2);
     RCC_ClkInitStruct.SYSCLKSource   = RCC_SYSCLKSOURCE_HSE;
     RCC_ClkInitStruct.AHBCLKDivider  = RCC_SYSCLK_DIV1;
     RCC_ClkInitStruct.APB1CLKDivider = RCC_HCLK_DIV1;
     RCC_ClkInitStruct.APB2CLKDivider = RCC_HCLK_DIV1;
     uint32_t flash_latency = 0;
     HAL_RCC_ClockConfig(&RCC_ClkInitStruct, flash_latency);
}

/**
  * @brief  This function is executed in case of error occurrence.
  * @retval None
  */
void Error_Handler(void)
{
  __disable_irq();
  while (1)
  {
  }
}

#ifdef  USE_FULL_ASSERT
/**
  * @brief  Reports the name of the source file and the source line number
  *         where the assert_param error has occurred.
  * @param  file: pointer to the source file name
  * @param  line: assert_param error line source number
  * @retval None
  */
void assert_failed(uint8_t *file, uint32_t line)
{
}
#endif /* USE_FULL_ASSERT */
